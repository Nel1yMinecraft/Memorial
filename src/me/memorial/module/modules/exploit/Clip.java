package me.memorial.module.modules.exploit;

import me.memorial.module.Module;
import me.memorial.module.ModuleCategory;
import me.memorial.module.ModuleInfo;
import me.memorial.value.FloatValue;
import me.memorial.value.ListValue;
import net.minecraft.network.play.client.C03PacketPlayer;
import net.minecraft.network.play.client.C03PacketPlayer.C04PacketPlayerPosition;
import static java.lang.Math.cos;
import static java.lang.Math.sin;

@ModuleInfo(name = "Clip", description = "Allows you to clip through blocks.", category = ModuleCategory.EXPLOIT, canEnable = false)
public class Clip extends Module {
    private final ListValue modeValue = new ListValue("Mode", new String[]{"Teleport", "Flag"}, "Teleport");
    private final FloatValue horizontalValue = new FloatValue("Horizontal", 0F, -10F, 10F);
    private final FloatValue verticalValue = new FloatValue("Vertical", 5F, -10F, 10F);

    @Override
    public void onEnable() {
        if (mc.thePlayer == null) return;

        double yaw = Math.toRadians(mc.thePlayer.rotationYaw);
        double x = -sin(yaw) * horizontalValue.get();
        double z = cos(yaw) * horizontalValue.get();

        String mode = modeValue.get().toLowerCase();
        if (mode.equals("teleport")) {
            mc.thePlayer.setPosition(mc.thePlayer.posX + x, mc.thePlayer.posY + verticalValue.get(), mc.thePlayer.posZ + z);
        } else if (mode.equals("flag")) {
            C03PacketPlayer netPacket = new C03PacketPlayer();
            netPacket.y = mc.thePlayer.posY;
            netPacket.onGround = true;

            for (int i = 0; i < 5; i++) {
                mc.getNetHandler().addToSendQueue(new C04PacketPlayerPosition(mc.thePlayer.posX, mc.thePlayer.posY, mc.thePlayer.posZ, true));
                mc.getNetHandler().addToSendQueue(new C04PacketPlayerPosition(0.5, 0.0, 0.5, true));
            }

            mc.thePlayer.setPosition(mc.thePlayer.posX - sin(yaw) * 0.04, mc.thePlayer.posY, mc.thePlayer.posZ + cos(yaw) * 0.04);
        }
    }
}
